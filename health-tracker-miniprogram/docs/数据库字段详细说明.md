# 📊 数据库字段详细说明

> **集合名称：** health_records  
> **用途：** 存储用户健康诊断记录

## 🏗️ 完整数据结构

### 🆔 标识字段
```javascript
{
  "_id": "自动生成的记录ID",
  "userId": "ogqhLvvFMqTh0MJ_j0RpteZTtewg",  // 用户微信OpenID
  "_openid": "ogqhLvvFMqTh0MJ_j0RpteZTtewg"  // 云开发用户标识
}
```

### ⏰ 时间字段
```javascript
{
  "createTime": "2025-08-05T11:33:45.631Z",  // 完整时间戳
  "date": "2025-08-05",                      // 日期(YYYY-MM-DD)
  "fullDate": "2025-08-05"                   // 完整日期(用于日历显示)
}
```

### 📝 用户输入数据 (formData)
```javascript
{
  "formData": {
    // 基本信息
    "basicInfo": {
      "age": "30",        // 用户年龄
      "gender": "male",   // 性别: male/female
      "height": "175",    // 身高(cm)
      "weight": "70"      // 体重(kg)
    },
    
    // 问题文本
    "questionTexts": {
      "question1": "您是否经常感到口干舌燥？",
      "question2": "您觉得自己的舌头颜色是？",
      "question3": "您觉得自己的舌苔厚度如何？",
      "question4": "您的睡眠质量如何？"
    },
    
    // 用户回答
    "quizAnswers": {
      "question1": "sometimes",    // never/sometimes/often/always
      "question2": "light-red",    // light-red/pale/red/dark-red
      "question3": "thin",         // thin/thick/no-coating/peeling
      "question4": "good"          // excellent/good/fair/poor
    },
    
    // AI澄清问题（如果有）
    "aiQuestions": [
      {
        "questionText": "您的消化情况如何？",
        "options": ["食欲正常，消化良好", "食欲不振", "腹胀胃痛", "大便不规律"]
      }
    ],
    
    // AI澄清问题的答案（如果有）
    "aiAnswers": {
      "question0": "食欲不振",
      "question1": "情绪不稳定"
    }
  }
}
```

### 🖼️ 图像数据
```javascript
{
  "imageUrl": "cloud://cloud1-6gg9zh5k6f75e020.636c-cloud1-6gg9zh5k6f75e020/tongue-images/tongue_123456789.jpg"
  // 舌头照片的云存储URL，如果用户跳过拍摄则为空字符串
}
```

### 🤖 AI分析结果 (analysis)
```javascript
{
  "analysis": {
    // 健康评分
    "healthScore": 85,              // 0-100分
    "bmi": 22.9,                   // BMI值
    "bmiStatus": "正常",            // 正常/偏瘦/偏重/肥胖
    
    // 整体评估
    "overallAssessment": "基于您的基本信息和问答结果，您的整体健康状况良好...",
    
    // 风险因素
    "riskFactors": ["口干舌燥频繁", "睡眠质量不佳"],
    
    // 建议
    "suggestions": ["建议多饮水，避免辛辣刺激食物", "建议规律作息"],
    
    // 舌诊分析
    "tongueAnalysis": {
      "color": "淡红色舌质正常，表示气血充足",
      "coating": "薄苔正常，消化功能良好",
      "overall": "根据您的描述，舌象基本正常，建议定期观察"
    },
    
    // 中医体质
    "tcmConstitution": "平和质 - 体质相对平衡，继续保持",
    
    // 季节养生建议
    "seasonalAdvice": "建议根据季节变化调整饮食，春夏养阳，秋冬养阴",
    
    // 随访建议
    "followUpRecommendations": ["建议3个月后复查", "注意观察舌象变化"],
    
    // 时间戳
    "timestamp": "2025-08-05T11:33:45.631Z",
    
    // 分析类型
    "analysisType": "mock",         // ai/mock
    
    // 免责声明
    "disclaimer": "此分析仅供参考，如有不适请及时就医"
  }
}
```

### 🔧 系统字段
```javascript
{
  "status": "completed",                    // 记录状态: completed/processing/failed
  "analysisType": "mock",                   // 分析类型: ai/mock/backup
  "apiSource": "qwen",                      // API来源: qwen/gemini/backup/mock
  "hasAIClarifyingQuestions": true,         // 是否包含AI澄清问题
  "clarifyingQuestionsCount": 2             // AI澄清问题数量
}
```

## 📈 数据统计

### 存储大小估算
- **每条记录：** 约 5-15 KB
- **主要占用：** formData(40%) + analysis(50%) + 其他(10%)
- **图片：** 单独存储在云存储中，不占用数据库空间

### 隐私与安全
- ✅ **不存储姓名/手机号等个人敏感信息**
- ✅ **使用微信OpenID作为用户标识**
- ✅ **健康数据仅用于个人健康管理**
- ✅ **图片存储在微信云存储中，有访问控制**

### 数据用途
1. **个人健康档案** - 用户查看历史健康记录
2. **趋势分析** - 健康状况变化趋势
3. **AI优化** - 改进AI分析准确性（匿名化）
4. **功能改进** - 优化产品功能和用户体验

## 🔍 查看数据的方法

### 方法1：小程序内查看
- 健康档案页面 → 点击日历日期
- 🔍调试按钮 → 查看统计信息

### 方法2：微信开发者工具
- 云开发 → 数据库 → health_records集合

### 方法3：腾讯云控制台
- 完整的数据库管理和统计功能