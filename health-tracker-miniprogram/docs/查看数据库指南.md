# 📊 数据库和API统计查看指南

## 1. 通过微信开发者工具查看数据库

### 步骤：
1. **打开微信开发者工具**
2. **点击"云开发"按钮**（工具栏中的云朵图标）
3. **选择数据库标签**
4. **查看 health_records 集合**

### 在数据库中可以看到：
- `_id`: 记录唯一ID
- `userId`: 用户OPENID
- `createTime`: 创建时间
- `formData`: 表单数据（年龄、性别、问答等）
- `analysis`: AI分析结果
- `apiSource`: 使用的API（Qwen/Gemini）
- `analysisType`: 分析类型
- `hasAIClarifyingQuestions`: 是否有AI澄清问题

## 2. 通过云函数日志查看API调用

### 步骤：
1. **微信开发者工具 → 云开发 → 云函数**
2. **点击具体云函数（analyze/generate-questions）**
3. **查看"调用日志"标签**

### 日志中包含：
- 请求时间和耗时
- API调用成功/失败状态
- 使用的模型（qwen-vl-max等）
- 错误信息（如果有）

## 3. 通过腾讯云控制台查看详细统计

### 步骤：
1. **访问 [腾讯云控制台](https://console.cloud.tencent.com/)**
2. **登录您的腾讯云账号**
3. **搜索"云开发"或"TCB"**
4. **选择您的环境 cloud1-6gg9zh5k6f75e020**

### 可查看的统计：
- **函数调用次数**
- **执行时长统计**
- **内存使用情况**
- **错误率统计**
- **费用统计**

## 4. 数据库查询语句

在数据库中可以使用以下查询：

```javascript
// 查看所有记录
db.collection('health_records').get()

// 查看特定用户记录
db.collection('health_records').where({
  userId: 'ogqhLvvFMqTh0MJ_j0RpteZTtewg'
}).get()

// 按日期排序查看最新记录
db.collection('health_records').orderBy('createTime', 'desc').get()

// 统计API使用情况
db.collection('health_records').where({
  apiSource: 'Qwen'
}).count()
```

## 5. API统计页面

您也可以在小程序中访问我们创建的API统计页面：
- 从结果页面点击"📊 查看AI分析统计"按钮
- 或直接导航到 `/pages/api-stats/index`